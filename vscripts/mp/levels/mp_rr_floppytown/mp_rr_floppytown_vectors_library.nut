untyped

globalize_all_functions

// Map Origin | Angles
global const vector FLOPPYTOWN_POS_OFFSET   = < 0, 0, 0 > // map origin // Zips appear with "mp_rr_floppytown_scripts.ent", map position change is not available anymore !
global const vector FLOPPYTOWN_ANG_OFFSET   = < 0, 0, 0 > // map angles // not usable !

// Map Origin | Angles
global const vector FT_BUILD_AREA_POS       = FLOPPYTOWN_POS_OFFSET + < -5000, 0, 1280 >
global const vector FT_BUILD_AREA_ANG       = FLOPPYTOWN_ANG_OFFSET + < 0, 180, 0 >

// Buildings Origin | Angles
global const vector FT_BUILDING_POS_01      = FLOPPYTOWN_POS_OFFSET + < 2664, 4352, 0 >
global const vector FT_BUILDING_ANG_01      = FLOPPYTOWN_ANG_OFFSET + < 0, 0, 0 >

global const vector FT_BUILDING_POS_02      = FLOPPYTOWN_POS_OFFSET + < 128, 4352, 0 >
global const vector FT_BUILDING_ANG_02      = FLOPPYTOWN_ANG_OFFSET + < 0, 0, 0 >

global const vector FT_BUILDING_POS_03      = FLOPPYTOWN_POS_OFFSET + < 64, 3328, 0 >
global const vector FT_BUILDING_ANG_03      = FLOPPYTOWN_ANG_OFFSET + < 0, 0, 0 >

global const vector FT_BUILDING_POS_04      = FLOPPYTOWN_POS_OFFSET + < 128, 2560, 0 >
global const vector FT_BUILDING_ANG_04      = FLOPPYTOWN_ANG_OFFSET + < 0, 0, 0 >

global const vector FT_BUILDING_POS_05      = FLOPPYTOWN_POS_OFFSET + < 128, 1856, 0 >
global const vector FT_BUILDING_ANG_05      = FLOPPYTOWN_ANG_OFFSET + < 0, 0, 0 >

global const vector FT_BUILDING_POS_06      = FLOPPYTOWN_POS_OFFSET + < 128, 1152, 0 >
global const vector FT_BUILDING_ANG_06      = FLOPPYTOWN_ANG_OFFSET + < 0, 0, 0 >

global const vector FT_BUILDING_POS_07      = FLOPPYTOWN_POS_OFFSET + < 128, 128, 0 >
global const vector FT_BUILDING_ANG_07      = FLOPPYTOWN_ANG_OFFSET + < 0, 0, 0 >

global const vector FT_BUILDING_POS_08      = FLOPPYTOWN_POS_OFFSET + < 2560, 128, 0 >
global const vector FT_BUILDING_ANG_08      = FLOPPYTOWN_ANG_OFFSET + < 0, 0, 0 >

global const vector FT_BUILDING_POS_09      = FLOPPYTOWN_POS_OFFSET + < 3456, 128, 0 >
global const vector FT_BUILDING_ANG_09      = FLOPPYTOWN_ANG_OFFSET + < 0, 0, 0 >

global const vector FT_BUILDING_POS_10      = FLOPPYTOWN_POS_OFFSET + < 4352, 128, 0 >
global const vector FT_BUILDING_ANG_10      = FLOPPYTOWN_ANG_OFFSET + < 0, 0, 0 >

global const vector FT_BUILDING_POS_11      = FLOPPYTOWN_POS_OFFSET + < 5376, 128, 0 >
global const vector FT_BUILDING_ANG_11      = FLOPPYTOWN_ANG_OFFSET + < 0, 0, 0 >

global const vector FT_BUILDING_POS_12      = FLOPPYTOWN_POS_OFFSET + < 5504, 1920, 0 >
global const vector FT_BUILDING_ANG_12      = FLOPPYTOWN_ANG_OFFSET + < 0, 0, 0 >

global const vector FT_BUILDING_POS_13      = FLOPPYTOWN_POS_OFFSET + < 5504, 3072, 0 >
global const vector FT_BUILDING_ANG_13      = FLOPPYTOWN_ANG_OFFSET + < 0, 0, 0 >

global const vector FT_BUILDING_POS_14      = FLOPPYTOWN_POS_OFFSET + < 4608, 4352, 0 >
global const vector FT_BUILDING_ANG_14      = FLOPPYTOWN_ANG_OFFSET + < 0, 0, 0 >

global const vector FT_BUILDING_POS_15      = FLOPPYTOWN_POS_OFFSET + < 1408, 4608, 0 >
global const vector FT_BUILDING_ANG_15      = FLOPPYTOWN_ANG_OFFSET + < 0, 0, 0 >

global const vector FT_BUILDING_POS_16      = FLOPPYTOWN_POS_OFFSET + < 4224, 3072, 0 >
global const vector FT_BUILDING_ANG_16      = FLOPPYTOWN_ANG_OFFSET + < 0, 0, 0 >

global const vector FT_BUILDING_POS_17      = FLOPPYTOWN_POS_OFFSET + < 1152, 3008, -6 >
global const vector FT_BUILDING_ANG_17      = FLOPPYTOWN_ANG_OFFSET + < 0, 0, 0 >

global const vector FT_BUILDING_POS_18      = FLOPPYTOWN_POS_OFFSET + < 2688, 2176, 0 >
global const vector FT_BUILDING_ANG_18      = FLOPPYTOWN_ANG_OFFSET + < 0, 0, 0 >

global const vector FT_BUILDING_POS_19      = FLOPPYTOWN_POS_OFFSET + < 4096, 1344, 0 >
global const vector FT_BUILDING_ANG_19      = FLOPPYTOWN_ANG_OFFSET + < 0, 0, 0 >

global const vector FT_BUILDING_POS_20      = FLOPPYTOWN_POS_OFFSET + < 1344, 1600, 0 >
global const vector FT_BUILDING_ANG_20      = FLOPPYTOWN_ANG_OFFSET + < 0, 0, 0 >

global const vector FT_BUILDING_POS_21      = FLOPPYTOWN_POS_OFFSET + < 0, 0, 0 >
global const vector FT_BUILDING_ANG_21      = FLOPPYTOWN_ANG_OFFSET + < 0, 0, 0 >

//global const vector FT_BUILDING_POS_22      = FLOPPYTOWN_POS_OFFSET + < 0, 0, 0 >
//global const vector FT_BUILDING_ANG_22      = FLOPPYTOWN_ANG_OFFSET + < 0, 0, 0 >

global const vector FT_FLOOR_POS            = FLOPPYTOWN_POS_OFFSET + < 0, 0, 0 >
global const vector FT_FLOOR_ANG            = FLOPPYTOWN_ANG_OFFSET + < 0, 180, 0 >

global const vector FT_GRASS_POS            = FLOPPYTOWN_POS_OFFSET + < -32, -32, 0 >
global const vector FT_GRASS_ANG            = FLOPPYTOWN_ANG_OFFSET + < 0, 0, 0 >

global const vector FT_NORTH_WALL_POS       = FLOPPYTOWN_POS_OFFSET + <0, 4864, 0>
global const vector FT_NORTH_WALL_ANG       = FLOPPYTOWN_ANG_OFFSET + < 0, 0, 0 >

global const vector FT_SOUTH_WALL_POS       = FLOPPYTOWN_POS_OFFSET + < 5888, 0, 0 >
global const vector FT_SOUTH_WALL_ANG       = FLOPPYTOWN_ANG_OFFSET + < 0, 0, 0 >

global const vector FT_WEST_WALL_POS        = FLOPPYTOWN_POS_OFFSET + < 0, 0, 0 >
global const vector FT_WEST_WALL_ANG        = FLOPPYTOWN_ANG_OFFSET + < 0, 0, 0 >

global const vector FT_EAST_WALL_POS        = FLOPPYTOWN_POS_OFFSET + < 5632, 4335, -0.1 >
global const vector FT_EAST_WALL_ANG        = FLOPPYTOWN_ANG_OFFSET + < 0, 0, 0 >

global const vector FT_LITTLE_BRIDGE_POS    = FLOPPYTOWN_POS_OFFSET + < 3840, 128, 2048 >
global const vector FT_LITTLE_BRIDGE_ANG    = FLOPPYTOWN_ANG_OFFSET + < 0, 0, 0 >

global const vector FT_BALCONY_LEFT_POS     = FT_BUILDING_POS_01 + < -272, -584, 576 >
global const vector FT_BALCONY_LEFT_ANG     = FT_BUILDING_ANG_01 + < 0, 0, 0 >

global const vector FT_BALCONY_RIGHT_POS    = FT_BUILDING_POS_01 + < 368, -584, 576 >
global const vector FT_BALCONY_RIGHT_ANG    = FT_BUILDING_ANG_01 + < 0, 0, 0 >

//Cargo on the ground
global const vector FT_CARGO_GROUND_FIRST_POS = FLOPPYTOWN_POS_OFFSET + < 1880, 3830, 0 >
global const vector FT_CARGO_GROUND_FIRST_ANG = FLOPPYTOWN_ANG_OFFSET + < 0, 90, 0 >

global const vector FT_CARGO_GROUND_SECOND_POS = FLOPPYTOWN_POS_OFFSET + < 3810, 2047, 0  >
global const vector FT_CARGO_GROUND_SECOND_ANG = FLOPPYTOWN_ANG_OFFSET + < 0, 90, 0 >

global const vector FT_CARGO_GROUND_THIRD_POS = FLOPPYTOWN_POS_OFFSET + < 2220, 985, 0  >
global const vector FT_CARGO_GROUND_THIRD_ANG = FLOPPYTOWN_ANG_OFFSET + < 0, 90, 0 >
//Cargo on the ground end

//
global const int    SSB_UP_TO_0             = 128 // set to 0 SQUARE_SHELL_BOX axis Z
global const float  SSB_UP_TO_0_PATCH       = SSB_UP_TO_0 - 0.1

entity function CreateFloppytownModel( asset a, vector pos, vector ang )
{
    entity prop = CreatePropDynamic( a, pos, ang, SOLID_VPHYSICS, 20000 )
    prop.kv.fadedist = 20000
    prop.AllowMantle()
    int realm = -1
    if ( realm> -1 )
    { prop.RemoveFromAllRealms(); prop.AddToRealm( realm ) }
    prop.e.gameModeId = realm

        /* if ( a == THUNDERDOME_CEILING )
        {
            
        } */

    prop.SetScriptName( "FloppytownEntities" )
return prop }

entity function CreateFloppyWallTrigger(vector pos, float box_radius = 1000 )
{
    entity map_trigger = CreateEntity( "trigger_cylinder" )
    map_trigger.SetRadius( box_radius );map_trigger.SetAboveHeight( 5000 );map_trigger.SetBelowHeight( 10 );
    map_trigger.SetOrigin( pos )
    DispatchSpawn( map_trigger )
    thread FloppyWallTrigger( map_trigger )
    return map_trigger
}

void function FloppyWallTrigger(entity proxy, float speed = 0.6)
{   bool active = true
    while (active)
    {   if(IsValid(proxy))
        {   foreach(player in GetPlayerArray())
            {   if (player.GetPhysics() != MOVETYPE_NOCLIP)//won't affect noclip player
                {   if(proxy.IsTouching(player))
				{
                    player.Zipline_Stop()
					switch(GetMapName())
					{
					    default:
					    	vector target_origin = player.GetOrigin()
                            target_origin.z = 0.0
					    	vector proxy_origin = proxy.GetOrigin()
					    	vector target_angles = player.GetAngles()
					    	vector proxy_angles = proxy.GetAngles()

					    	vector velocity = target_origin - proxy_origin
					    	velocity = velocity * speed

					    	vector angles = target_angles - proxy_angles

					    	velocity = velocity + angles
					    	player.SetVelocity(velocity)
			}   }   }   }
        } else {active = false ; break}
        wait 0.01
}   }

array< entity > function CreateFloppytownZiplineModel( vector pos, vector ang )
{
    entity column   = CreateFloppytownModel( SECURITY_FENCE, pos, ang )
    entity support  = CreateFloppytownModel( ZIP_ARM, pos + < 0, 0, 185 >, ang )

return [ column, support ] }

entity function CreateEditorRef( vector pos, vector ang, string name )
{
    entity editor_ref = CreateFloppytownModel( EDITOR_REF, pos, ang )
    SetTargetName( editor_ref, name )
    editor_ref.SetScriptName( "editor_ref" )
return editor_ref }

void function Floppytown_MapInit_Library()
{
    printt( "Floppytown_MapInit_Library OK" )
}
